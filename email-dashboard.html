<!DOCTYPE html>
<html lang="en" class="no-js">
<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<head>
    <!-- Mail API -->
    <script src="mail/techmark-mail-api.js"></script>
    <script>
        if(sessionStorage.getItem("emailid")==null){
            if(localStorage.getItem("emailid")==null){
                location = "auth-signin.html";
            }else{
                sessionStorage.setItem("emailid", localStorage.getItem("emailid"));
                init();
            }
        }else{
            init();
        }

        function init(){
                        const clientId = '695366327438-1klcrac1lj6oo79s5n6sifie8ieerrjj.apps.googleusercontent.com';
                        const redirectUri = 'https://techmarkapp.netlify.app/email-dashboard';
                        const clientSecret = "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";
                        const event = {
                            "email": sessionStorage.getItem("emailid"),
                            "clientId": clientId,
                            "clientSecret": clientSecret,
                            "redirect_uri": redirectUri
                        }
                        flow(event);
                    }
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TechMark</title>
    <meta name="description" content="TechMark" />
    <meta name="keywords" content="" />
    <meta name="author" content="LSIT Development" />

    <link rel="shortcut icon" href="images/icn.png">

    <!-- Magnific-popup -->
    <link rel="stylesheet" href="css/magnific-popup.css">

    <!--Slider Css-->
    <link href="css/owl.carousel.css" rel="stylesheet">
    <link href="css/owl.theme.css" rel="stylesheet">
    <link href="css/owl.transitions.css" rel="stylesheet">

    <!-- Icon -->
    <link rel="stylesheet" type="text/css" href="css/pe-7s-icon.css" />
    <link rel="stylesheet" type="text/css" href="css/materialdesignicons.min.css" />
    <link rel="stylesheet" href="css/animate.min.css">

    <!-- Animation css -->
    <link href="css/aos.css" rel="stylesheet">
    <link rel="stylesheet" href="css/animate.min.css">  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--bootstrap Css-->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-*********************" crossorigin="anonymous" />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <meta charset="utf-8" />
	<link rel="stylesheet" href="mail/editor/res/style.css" />
</head>

    <body>
        <!-- START NAVBAR -->
        <nav class="navbar navbar-expand-lg fixed-top custom_nav_menu sticky">
            <div class="container">
                <!-- LOGO -->
                <a class='navbar-brand logo' href='index.html'>
                    <img src="images/logo-2.png" alt="" class="img-fluid logo-light">
                    <img src="images/logo-dark.png" alt="" class="img-fluid logo-dark">
                </a>

                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="mdi mdi-menu"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class='nav-link' href='index.html'>HOME</a>
                        </li>
                        <li class="nav-item active">
                            <a class='nav-link' href='services.html'>SERVICES</a>
                        </li>
                        <li class="nav-item">
                            <a class='nav-link' href='pricing.html'>PRICING</a>
                        </li>
                        <li class="nav-item">
                            <a class='nav-link' href='aboutus.html'>ABOUT</a>
                        </li>
                        <li class="nav-item">
                            <a class='nav-link' href='contact-us.html'>CONTACT</a>
                        </li>
                        <li class="nav-item" id="auth-btn"></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- END NAVBAR -->

       <!-- Start Cta -->
       <section class="section_all bg-cta-img" id="counter">
        <div class="bg_overlay_cover_on"></div>
        <div class="container">
            <div class="row" data-aos="fade-up">
                <div class="col-lg-12">
                    <div class="text-center text-white">
                        <h2 class="font-weight-bold">Email Dashboard</h2>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- End Cta -->
        
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom px-2">
        <div class="container">
          <a class="navbar-brand" href="#" style="min-width:180px">
            <h4>Menu</h4>
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav">
              <li class="nav-item">
                <a class="nav-link auth-btn mx-2" aria-current="page" href="email-dashboard.html" style="background-color: #45d56d; border-radius: 5px;">Send Emails</a>
              </li>
              <li class="nav-item">
                <a class="nav-link auth-btn mx-2" aria-current="page" href="https://mail.google.com/mail/" style="background-color: #45d56d; border-radius: 5px;">Gmail</a>
              </li>
              <li class="nav-item">
                <a class="nav-link auth-btn mx-2" aria-current="page" href="subjectlines.html" style="background-color: #45d56d; border-radius: 5px;">Subjectlines</a>
              </li>
            </ul>
            <!--<ul class="navbar-nav ms-auto d-none d-lg-inline-flex">
              <li class="nav-item mx-2">
                <a class="nav-link" href="#" >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart" viewBox="0 0 16 16">
                    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM3.102 4l1.313 7h8.17l1.313-7H3.102zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                </svg>
                  <span class="ms-1 align-middle">Cart</cart>
                </a>
              </li>
              <li class="nav-item mx-2">
                <a class="nav-link" href="#" >
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                    <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
                  </svg>
                  <span class="ms-1 align-texttop">Login</span>
                </a>
              </li>
            </ul>-->
          </div>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-12" style="text-align: center;">
                <br>
                <h2 style="color: white; font-weight: bold; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">Send Emails</h2>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h5 style="color: white; font-weight: bold;">Compose Email</h5>
                <label style="color: white; font-weight: bold;">From</label>
            <div id="email-from"></div>
                <label style="color: white; font-weight: bold;">Subject</label>
                <input id="subject" class="email-input">
                <label style="color: white; font-weight: bold;">To</label>
                <textarea class="email-list" oninput="countLines()" placeholder="Enter Emails on newlines" id="email-list"></textarea>
            <div style="color: white; font-weight: bold;"><span id="lineCount">Number of Lines: 0</span>&nbsp;&nbsp;&nbsp;<span id="validEmailCount">Number of valid emails: 0</span></div>
            <br>
            </div>
            <div class="col-md-6" id="send-emails-btn-row">
                <h5 style="color: white; font-weight: bold;">Valid Emails</h5>
                <div id="valid-emails-frame">
                    <ol id="valid-emails"></ol>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12" style="text-align: center;">
                <h6 style="color: white; font-weight: bold; font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;">Message</h6>
                <hr>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div style="margin:auto;padding:12px 6px 36px;max-width:960px;">
                    <div class="hs-docs-content-divider">
                    <link rel="stylesheet" href="mail/editor/richtexteditor/rte_theme_default.css" />
                    <script type="text/javascript" src="mail/editor/richtexteditor/rte.js"></script>
                    <script type="text/javascript" src='mail/editor/richtexteditor/plugins/all_plugins.js'></script>
                    <div id="div_editor1"></div>
                    <div id="send-emails-btn">
                        <button class="btn btn-sm btn-outline-primary" onclick="processEmails()" style="margin:auto;padding:12px 6px 15px;max-width:960px; width:100%; position: relative; margin-top: -0.8cm; background-color: #45d56d; border-color: #45d56d;">Send Email</button>
                    </div>
                    <script>
                        var editor1 = new RichTextEditor("#div_editor1");
                    </script>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function editor(){
            document.getElementById("preview").innerHTML = editor1.getHTMLCode();
        }
    </script>
        
    <div class="container">
        <div class="row">
            <div class="col-md-12" id="send-emails-btn-row">
                <h5 style="color: white; font-weight: bold;">Sending Log</h5>
                <div id="SuccessLog">
                    <table class="styled-table" id="mailLog">
                        <tr>
                            <th>No</th>
                            <th>Email Address</th>
                            <th>Sending Status</th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12" style="color: white; font-weight: bold;">
                <span id="seccessEmails">Success: 0</span>&nbsp;&nbsp;&nbsp;<span id="failedEmails">Failed: 0</span>
            </div>
        </div>
    </div>
    <hr>
    <!-- Footer Start -->
    <section class="section_all bg_footer">
        <div class="container ">
            <div class="row ">
                <div class="col-lg-4">
                    <div class="business_footer_logo mt-3">
                        <img src="images/logo-dark.png" alt="" class="img-fluid">
                        <p class=" mt-3"></p>
                    </div>
                    <div class="buss_icon_social_footer mt-3">
                        <ul class="list-inline mb-0 ">
                            <li class="list-inline-item "><a href=" " class=" "><i class="mdi mdi-facebook "></i></a></li>
                            <li class="list-inline-item "><a href=" " class=" "><i class="mdi mdi-twitter "></i></a></li>
                            <li class="list-inline-item "><a href=" " class=" "><i class="mdi mdi-linkedin "></i></a></li>
                            <li class="list-inline-item "><a href=" " class=" "><i class="mdi mdi-google-plus "></i></a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 ">
                    <div class="footer_heading_tag mt-3 ">
                        <p class="text-uppercase font-weight-bold text-white ">Services</p>
                    </div>
                    <div class="buss_footer_menu_list mt-3 ">
                        <ul class="list-unstyled mb-0 ">
                            <li><a href="# ">About Us </a></li>
                            <li><a href="# ">Social Media</a></li>
                            <li><a href="# ">General Question</a></li>
                            <li><a href="# ">Services</a></li>
                            <li><a href="# ">Privacy</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-2">
                    <div class="footer_heading_tag mt-3 ">
                        <p class="text-uppercase font-weight-bold text-white ">Resource</p>
                    </div>
                    <div class="buss_footer_menu_list mt-3 ">
                        <ul class="list-unstyled mb-0 ">
                            <li><a href="# ">Blog </a></li>
                            <li><a href="# ">Reviewes</a></li>
                            <li><a href="techmarkTutorial.html">Tutorials</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 ">
                    <div class="contact_details_content mt-3 ">
                        <div class="footer_heading_tag ">
                            <p class="text-uppercase font-weight-bold text-white ">Address</p>
                        </div>
                        <div class="contact_detail ">
                            <p class=" mb-0 ">PUNE, MH, IN</p>
                        </div>
                    </div>
                    <div class="contact_details_content ">
                        <div class="contact_detail ">
                            <p class=" mb-0 ">techmark@gmail.com</p>
                        </div>
                    </div>
                    <div class="contact_details_content  ">
                        <div class="contact_detail">
                            <p class=" mb-0 ">+91 (87967) (75539)
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-3 ">
                <div class="col-lg-12 ">
                    <div class="text-center mt-3 ">
                        <p class="footer_alt_cpy mb-0 ">2023 © TechMark. Design by LSIT Development</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Footer end -->

    <!-- Script -->
        <script>
            document.getElementById("email-from").innerHTML = '<input class="email-input" value="'+ sessionStorage.getItem("emailid") +'" disabled>';
            var Log = true;
            var tempCount = 0;
            function processEmails() {
                // Get the value from the textarea
                var text = document.getElementById('email-list').value;
                var emailRegex = /\b[A-Za-z0-9._]+@(?:[A-Za-z0-9-]+\.)+(?:com|org|in|in.net|net.in|net|co|co.in|uk|group|digital|io|ai|live|studio|ventures)\b/g;
                // Find all matches of valid email patterns in the textarea
                var validEmails = text.match(emailRegex);

                // Count the number of valid emails
                var validEmailCount = validEmails ? validEmails.length : 0;
                // Split the text by new lines to get individual emails
                // Process the emails (for example, validation or further handling)
                if(validEmails){
                    if(validEmailCount != tempCount || validEmailCount == tempCount){
                        validEmails.forEach((email, index) => {
                            setTimeout(() => {
                                document.getElementById('send-emails-btn').innerHTML = '<button class="btn btn-sm btn-outline-primary" onclick="AlertBtn()" style="margin:auto;padding:12px 6px 15px;max-width:960px; width:100%; position: relative; margin-top: -0.8cm; background-color: tomato; border-color: tomato;">Sending...</button>';
                                sendMail(email.trim());
                                tempCount++;
                            }, index * 500);
                        });
                    }
                }else{
                    tempCount = 0;
                }
            }

            var temp = 0;
            function countLines() {
                var text = document.getElementById('email-list').value;
                var lineCount = (text.match(/\n/g) || []).length + 1;
                document.getElementById('lineCount').innerText = 'Number of Lines: ' + lineCount;
                var emailRegex = /\b[A-Za-z0-9._]+@(?:[A-Za-z0-9-]+\.)+(?:com|org|in|in.net|net.in|net|co|co.in|uk|group|digital|io|ai|live|studio|au)\b/g;
                // Find all matches of valid email patterns in the textarea
                var validEmails = text.match(emailRegex);

                // Count the number of valid emails
                var validEmailCount = validEmails ? validEmails.length : 0;
                // Split the text by new lines to get individual emails
                // Process the emails (for example, validation or further handling)
                if(validEmails){
                    if(validEmailCount != temp || validEmailCount == temp){
                        document.getElementById("valid-emails").innerHTML = "";
                        validEmails.forEach(email => {
                        // Perform validation or use the emails as needed
                        // Here, you can perform actions like validation or sending data to the server
                        document.getElementById("valid-emails").innerHTML += "<li>"+ email.trim() +"</li>";
                        temp++;
                    });
                }
             }else{
                document.getElementById("valid-emails").innerHTML = "";
                temp = 0;
             }
                document.getElementById('validEmailCount').innerText = 'Number of valid emails: ' + validEmailCount;
            }

            function AlertBtn(){
                alert("Please wait while sending emails...");
            }
        </script>
    <!--Style-->

<!--Mails-->
<script>
function textToHTML(text) {
// Replace line breaks with <br> tags
const lines = text.split('\n').map(line => line ? `<div>${line}</div>` : '<div>&nbsp;</div>').join('');
return `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML Content from Plain Text</title>
</head>
<body>
${lines}
</body>
</html>`;
}

var Success = 1;
var failed = 1;
var EmailCount = 1;
function sendMail(mailId){
                
const htmlContent = editor1.getHTMLCode();
              
const raw = 
`From: ${sessionStorage.getItem("emailid")}
To: ${mailId}      
Subject: ${document.getElementById("subject").value}
MIME-Version: 1.0
Content-Type: multipart/alternative; boundary="techmark-mail-boundary"

--techmark-mail-boundary
Content-Type: text/plain; charset="UTF-8"

${editor1.getPlainText()}

--techmark-mail-boundary
Content-Type: text/html; charset="UTF-8"

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HTML Content from Plain Text</title>
</head>
<body>
${htmlContent}
</body>
</html>

--techmark-mail-boundary--`;

    const requestBody = {
        // Your request body data (could be an object or any data format required by the API)
        "raw": btoa(unescape(encodeURIComponent(raw)))
    };
    
    //const token = sessionStorage.getItem("bearer");
    fetch('https://gmail.googleapis.com/gmail/v1/users/'+ sessionStorage.getItem("emailid")+ '/messages/send', {
         method: 'POST', // Change the method accordingly (POST, PUT, etc.)
         headers: {
            'Authorization': `Bearer ${decodeURIComponent(escape(atob(sessionStorage.getItem("bearer"))))}`,
            'Content-Type': 'application/json', // Adjust the content type as needed
            // Add other headers if required by the API
        },
         body: JSON.stringify(requestBody) // Convert the request body to JSON string
        }).then(response => {
         if (!response.ok) {
            return false
        }
         return response.json();
        }).then(data => {
            if(data["id"]){
                console.log(data)
                document.getElementById("mailLog").innerHTML += '<tr><td>'+ EmailCount +'</td><td>'+ mailId +'</td><td style="color: #45d56d;"><i class="fas fa-check"></i> SENT</td></tr>';
                document.getElementById("seccessEmails").innerHTML = "Success:" + Success;
                document.getElementById('send-emails-btn').innerHTML = '<button class="btn btn-sm btn-outline-primary" onclick="processEmails()" style="margin:auto;padding:12px 6px 15px;max-width:960px; width:100%; position: relative; margin-top: -0.8cm; background-color: #45d56d; border-color: #45d56d;">Send Email</button>';
                Success++;
                EmailCount++;
            }else{
                document.getElementById("mailLog").innerHTML += '<tr><td>'+ EmailCount +'</td><td>'+ mailId +'</td><td style="color: red;"><i class="fas fa-times"></i>Failed</td></tr>';
                document.getElementById("failedEmails").innerHTML = "Failed:" + failed;
                document.getElementById('send-emails-btn').innerHTML = '<button class="btn btn-sm btn-outline-primary" onclick="processEmails()" style="margin:auto;padding:12px 6px 15px;max-width:960px; width:100%; position: relative; margin-top: -0.8cm; background-color: #45d56d; border-color: #45d56d;">Send Email</button>';
                failed++;
                EmailCount++;
            }
        }).catch(error => {
        document.getElementById("mailLog").innerHTML += '<tr><td>'+ mailId +'</td><td style="color: red;"><i class="fas fa-times"></i>Error</td></tr>';
        console.log(EmailCount + ":- " + error.message);
    });
}
    
    </script>

    <!--Mails-->
    <style>
        body{
            background-color: #474747;
            background-image: url('images/email-bg.jpg');
            background-size: 100% 100%;
            background-size: cover;
        }
        .email-input{
            width: 100%;
            border: 1px solid #ccc;
            background-color: #fdfdfd;
            color: #000000;
            font-weight: bold;
            opacity: 0.8;
            
        }
        .email-message{
            width: 100%;
            height: 348px; /* Adjust height as needed */
            padding-top: 20px; /* Space for lines */
            box-sizing: border-box;
            border: 1px solid #ccc;
            resize: none;
            background-color: #ffffff;
            color: #000000;
            font-weight: bold;
            opacity: 0.8;
        }
        .email-list{
            width: 100%;
            height: 350px; /* Adjust height as needed */
            padding-top: 20px; /* Space for lines */
            box-sizing: border-box;
            border: 1px solid #ccc;
            resize: none;
            background-color: #ffffff;
            color: #000000;
            font-weight: bold;
            opacity: 0.8;
        }
        #valid-emails-frame {
            height: 500px; /* Set the height to create a scrollable area */
            overflow-y: scroll; /* Enable vertical scrolling */
            border: 1px solid #ccc;
            background-color: white;
            color: #000000;
            font-weight: bold;
            opacity: 0.8;
            }

        #SuccessLog{
            height: 500px; /* Set the height to create a scrollable area */
            overflow-y: scroll; /* Enable vertical scrolling */
            border: 1px solid #ccc;
            background-color: white;
            color: #000000;
            font-weight: bold;
            opacity: 0.8;
        }
            
        #send-emails-btn-row{
            border-style: none;
            border-width: 100%;
            text-align: center;
        }
        .styled-table {
            border-collapse: collapse;
            width: 100%;
            }
        .styled-table th, .styled-table td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
            }
        .styled-table th {
            background-color: #f2f2f2;
            }
        /* send btn */
        .button-88 {
        font-family: inherit;
        font-weight: 500;
        font-size: 16px;
        padding: 0.7em 1.4em 0.7em 1.1em;
        color: white;
        background: #ad5389;
        background: linear-gradient(0deg, #14a73e 0%, rgba(102,247,113,1) 100%);
        border: none;
        box-shadow: 0 0.7em 1.5em -0.5em #14a73e98;
        letter-spacing: 0.05em;
        border-radius: 20em;
        cursor: pointer;
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        }
        .button-88:hover {
        box-shadow: 0 0.5em 1.5em -0.5em #14a73e98;
        }
        .button-88:active {
        box-shadow: 0 0.3em 1em -0.5em #14a73e98;
        }
    </style>
    <!--Style-->
    <!-- Script -->
    <!-- JAVASCRIPTS -->
    <script src="js/bootstrap.min.js"></script>
    <!--TESTISLIDER JS-->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/isotope.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/scrollspy.min.js"></script>
    <script src="js/jquery.easing.min.js"></script>
    <!-- Animate js -->
    <script src="js/custom.js"></script>
    <script src="js/main.js"></script>
    </body>
</html>